{% extends "base.html" %}
{% block content %}
<h2>Личный кабинет</h2>

<h4>Контактные данные</h4>
<form method="post">
  {% csrf_token %}
  {{ profile_form.as_p }}
  <button type="submit" name="update_profile" class="btn btn-primary">Сохранить</button>
</form>

<hr>

<h4>Привязанные устройства</h4>
<ul>
  {% for device in devices %}
    <li>{{ device.device_id }} (добавлено {{ device.created_at|date:"d.m.Y H:i" }})</li>
    <li>{{ device. }}</li>
    <a href="{% url 'accounts:delete_device' device.id %}" 
         class="btn btn-danger btn-sm"
         onclick="return confirm('Удалить это устройство?');">
         Удалить
    </a>
  {% empty %}
    <li>У вас пока нет устройств</li>
  {% endfor %}
</ul>

<h5>Добавить новое устройство</h5>
<form method="post">
  {% csrf_token %}
  {{ device_form.as_p }}
  <button type="submit" name="add_device" class="btn btn-success">Привязать устройство</button>
</form>


<h4 class="mt-4">История заказов</h4>
<ul>
  {% for order in orders %}
    <li>
      Заказ №{{ order.id }} от {{ order.created_at|date:"d.m.Y H:i" }} —
      Статус: {{ order.get_status_display }}
      <ul>
        {% for item in orders.items.all %}
          <li>{{ item.filament.brand }} {{ item.filament.material }} — {{ item.quantity }} шт. ({{ item.get_total }} ₽)</li>
        {% endfor %}
      </ul>
      <strong>Итого:</strong> {{ order.get_total_price }} ₽
    </li>
  {% empty %}
    <li>У вас пока нет заказов.</li>
  {% endfor %}
</ul>

{% endblock %}