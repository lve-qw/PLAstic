{% extends "base.html" %}
{% load static %}

{% block title %}{{ filament.brand }} {{ filament.material }} - {{ filament.color }} - FilamentStore{% endblock %}
{% block meta_description %}{{ filament.brand }} {{ filament.material }} цвета {{ filament.color }} для 3D-печати. {{ filament.description|truncatewords:20 }}{% endblock %}

{% block content %}
<div class="product-detail">
    <div class="container">
        <!-- Хлебные крошки -->
        <nav class="breadcrumb">
            <a href="{% url 'core:home' %}" class="breadcrumb__link">Главная</a>
            <span class="breadcrumb__separator">/</span>
            <a href="{% url 'catalog:list' %}" class="breadcrumb__link">Каталог</a>
            <span class="breadcrumb__separator">/</span>
            <span class="breadcrumb__current">{{ filament.brand }}</span>
        </nav>

        <div class="product-layout">
            <!-- Галерея изображений -->
            <div class="product-gallery">
                <div class="gallery-main">
                    {% if filament.image %}
                    <img src="{{ filament.image.url }}" 
                         alt="{{ filament.brand }} {{ filament.material }} - {{ filament.color }}" 
                         class="gallery-main__image"
                         id="mainImage">
                    {% else %}
                    <div class="gallery-main__placeholder">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                        </svg>
                        <p>Изображение отсутствует</p>
                    </div>
                    {% endif %}
                    
                    {% if filament.is_new %}
                    <span class="product-badge product-badge--new">Новинка</span>
                    {% endif %}
                    {% if filament.stock < 10 and filament.stock > 0 %}
                    <span class="product-badge product-badge--limited">Заканчивается</span>
                    {% endif %}
                    {% if filament.stock == 0 %}
                    <span class="product-badge product-badge--out-of-stock">Нет в наличии</span>
                    {% endif %}
                </div>

                <!-- Дополнительные изображения (можно добавить в будущем) -->
                <div class="gallery-thumbs">
                    {% if filament.image %}
                    <div class="thumb active" data-image="{{ filament.image.url }}">
                        <img src="{{ filament.image.url }}" alt="Основное изображение">
                    </div>
                    {% endif %}
                    <!-- Можно добавить дополнительные изображения -->
                </div>
            </div>

            <!-- Основная информация о товаре -->
            <div class="product-info">
                <div class="product-header">
                    <h1 class="product-title">{{ filament.brand }}</h1>
                    <div class="product-meta">
                        <span class="product-material">{{ filament.material }}</span>
                        <span class="product-color">
                            <span class="color-sample" style="background-color: {{ filament.color_hex|default:'#666' }};"></span>
                            {{ filament.color }}
                        </span>
                    </div>
                </div>

                <!-- Рейтинг и отзывы -->
                <div class="product-rating">
                    <div class="rating-stars">
                        {% for i in "12345" %}
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="{% if forloop.counter <= filament.rating|default:4 %}currentColor{% else %}none{% endif %}" 
                             stroke="currentColor" class="star {% if forloop.counter <= filament.rating|default:4 %}star--filled{% endif %}">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% endfor %}
                    </div>
                    <span class="rating-text">(12 отзывов)</span>
                </div>

                <!-- Цена и наличие -->
                <div class="product-pricing">
                    <div class="price-block">
                        <span class="price-current">{{ filament.price }} ₽</span>
                        {% if filament.old_price %}
                        <span class="price-old">{{ filament.old_price }} ₽</span>
                        <span class="price-discount">-{{ filament.discount_percent }}%</span>
                        {% endif %}
                    </div>
                    
                    <div class="stock-info">
                        {% if filament.stock > 10 %}
                        <span class="stock-available">✓ В наличии</span>
                        {% elif filament.stock > 0 %}
                        <span class="stock-limited">⚠ Осталось мало: {{ filament.stock }} шт.</span>
                        {% else %}
                        <span class="stock-out">✗ Нет в наличии</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Основные характеристики -->
                <div class="product-specs">
                    <h3 class="specs-title">Основные характеристики</h3>
                    <div class="specs-grid">
                        <div class="spec-item">
                            <span class="spec-label">Бренд:</span>
                            <span class="spec-value">{{ filament.brand }}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Материал:</span>
                            <span class="spec-value">{{ filament.material }}</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Цвет:</span>
                            <span class="spec-value">
                                <span class="color-sample" style="background-color: {{ filament.color_hex|default:'#666' }};"></span>
                                {{ filament.color }}
                            </span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Диаметр:</span>
                            <span class="spec-value">{{ filament.diameter }} мм</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Вес:</span>
                            <span class="spec-value">{{ filament.weight }} г</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Температура печати:</span>
                            <span class="spec-value">{{ filament.print_temperature|default:"190-220°C" }}</span>
                        </div>
                    </div>
                </div>

                <!-- Действия с товаром -->
                <div class="product-actions">
                    {% if filament.stock > 0 %}
                    <form method="post" action="{% url 'cart:add' filament.id %}" class="action-form">
                        {% csrf_token %}
                        <div class="quantity-selector">
                            <button type="button" class="quantity-btn" data-action="decrease">-</button>
                            <input type="number" name="quantity" value="1" min="1" max="{{ filament.stock }}" class="quantity-input">
                            <button type="button" class="quantity-btn" data-action="increase">+</button>
                        </div>
                        <button type="submit" class="btn btn--primary btn--large btn--full">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            </svg>
                            Добавить в корзину
                        </button>
                    </form>
                    {% else %}
                    <button class="btn btn--disabled btn--large btn--full" disabled>
                        Нет в наличии
                    </button>
                    {% endif %}
                    
                    <div class="action-buttons">
                        <button class="btn btn--outline btn--icon" title="В избранное">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9.653 16.915l-.005-.003-.019-.01a20.759 20.759 0 01-1.162-.682 22.045 22.045 0 01-2.582-1.9C4.045 12.733 2 10.352 2 7.5a4.5 4.5 0 018-2.828A4.5 4.5 0 0118 7.5c0 2.852-2.044 5.233-3.885 6.82a22.049 22.049 0 01-3.744 2.582l-.019.01-.005.003h-.002a.739.739 0 01-.69.001l-.002-.001z"/>
                            </svg>
                            В избранное
                        </button>
                        <button class="btn btn--outline btn--icon" title="Поделиться">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                            </svg>
                            Поделиться
                        </button>
                    </div>
                </div>

                <!-- Дополнительная информация -->
                <div class="product-features">
                    <div class="feature-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Гарантия качества</span>
                    </div>
                    <div class="feature-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 6H4a2 2 0 00-2 2v8a2 2 0 002 2h16a2 2 0 002-2V8a2 2 0 00-2-2z"/>
                        </svg>
                        <span>Вакуумная упаковка</span>
                    </div>
                    <div class="feature-item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Быстрая доставка</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Описание товара -->
        <div class="product-description">
            <div class="description-tabs">
                <button class="tab-btn active" data-tab="description">Описание</button>
                <button class="tab-btn" data-tab="specs">Характеристики</button>
                <button class="tab-btn" data-tab="reviews">Отзывы (12)</button>
            </div>
            
            <div class="tab-content">
                <div class="tab-pane active" id="description">
                    <h3>О товаре</h3>
                    <p>{{ filament.description|default:"Высококачественный филамент для 3D-печати. Идеально подходит для создания прочных и точных моделей. Поддерживает стабильную экструзию и обеспечивает гладкую поверхность готовых изделий." }}</p>
                    
                    <div class="description-features">
                        <h4>Особенности:</h4>
                        <ul>
                            <li>Высокое качество печати</li>
                            <li>Стабильная диаметральная точность</li>
                            <li>Минимальная усадка</li>
                            <li>Хорошая адгезия слоев</li>
                            <li>Подходит для большинства 3D-принтеров</li>
                        </ul>
                    </div>
                </div>
                
                <div class="tab-pane" id="specs">
                    <h3>Технические характеристики</h3>
                    <div class="specs-detail">
                        <div class="spec-row">
                            <span class="spec-name">Материал</span>
                            <span class="spec-value">{{ filament.material }}</span>
                        </div>
                        <div class="spec-row">
                            <span class="spec-name">Диаметр</span>
                            <span class="spec-value">{{ filament.diameter }} мм ± 0.02 мм</span>
                        </div>
                        <div class="spec-row">
                            <span class="spec-name">Вес бобины</span>
                            <span class="spec-value">{{ filament.weight }} г</span>
                        </div>
                        <div class="spec-row">
                            <span class="spec-name">Температура печати</span>
                            <span class="spec-value">190-220°C</span>
                        </div>
                        <div class="spec-row">
                            <span class="spec-name">Температура стола</span>
                            <span class="spec-value">50-60°C</span>
                        </div>
                        <div class="spec-row">
                            <span class="spec-name">Скорость печати</span>
                            <span class="spec-value">40-80 мм/с</span>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane" id="reviews">
                    <h3>Отзывы покупателей</h3>
                    <div class="reviews-summary">
                        <div class="rating-overview">
                            <div class="rating-average">
                                <span class="average-score">4.8</span>
                                <div class="rating-stars">
                                    {% for i in "12345" %}
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="{% if forloop.counter <= 4 %}currentColor{% else %}none{% endif %}" 
                                         stroke="currentColor">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                    </svg>
                                    {% endfor %}
                                </div>
                                <span class="reviews-count">на основе 12 отзывов</span>
                            </div>
                        </div>
                    </div>
                    <div class="reviews-placeholder">
                        <p>Здесь будут отображаться отзывы покупателей</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Product Detail Styles */
.product-detail {
    padding: 2rem 0;
}

.breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
    color: #6b7280;
}

.breadcrumb__link {
    color: #6366f1;
    text-decoration: none;
}

.breadcrumb__link:hover {
    text-decoration: underline;
}

.breadcrumb__separator {
    color: #d1d5db;
}

.breadcrumb__current {
    color: #374151;
    font-weight: 500;
}

.product-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    margin-bottom: 4rem;
}

@media (min-width: 1024px) {
    .product-layout {
        grid-template-columns: 1fr 1fr;
    }
}

/* Gallery */
.product-gallery {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.gallery-main {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #f9fafb;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 400px;
}

.gallery-main__image {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: contain;
}

.gallery-main__placeholder {
    text-align: center;
    color: #d1d5db;
    padding: 2rem;
}

.gallery-main__placeholder svg {
    margin-bottom: 1rem;
}

.gallery-thumbs {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
}

.thumb {
    width: 80px;
    height: 80px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    flex-shrink: 0;
    transition: border-color 0.3s ease;
}

.thumb.active {
    border-color: #6366f1;
}

.thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Product Badges */
.product-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    color: white;
}

.product-badge--new {
    background: #10b981;
}

.product-badge--limited {
    background: #f59e0b;
}

.product-badge--out-of-stock {
    background: #ef4444;
}

/* Product Info */
.product-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.product-header {
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 1rem;
}

.product-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 0.5rem 0;
}

.product-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.product-material {
    background: #6366f1;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.product-color {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #6b7280;
}

.color-sample {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid #e5e7eb;
}

/* Rating */
.product-rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.rating-stars {
    display: flex;
    gap: 0.125rem;
}

.star {
    width: 20px;
    height: 20px;
}

.star--filled {
    fill: #f59e0b;
    stroke: #f59e0b;
}

.rating-text {
    font-size: 0.875rem;
    color: #6b7280;
}

/* Pricing */
.product-pricing {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
}

.price-block {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.price-current {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
}

.price-old {
    font-size: 1.25rem;
    color: #6b7280;
    text-decoration: line-through;
}

.price-discount {
    background: #ef4444;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 600;
}

.stock-info {
    font-size: 0.875rem;
    font-weight: 500;
}

.stock-available {
    color: #10b981;
}

.stock-limited {
    color: #f59e0b;
}

.stock-out {
    color: #ef4444;
}

/* Specs */
.product-specs {
    background: #f9fafb;
    padding: 1.5rem;
    border-radius: 8px;
}

.specs-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
    color: #1f2937;
}

.specs-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
}

@media (min-width: 640px) {
    .specs-grid {
        grid-template-columns: 1fr 1fr;
    }
}

.spec-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #e5e7eb;
}

.spec-item:last-child {
    border-bottom: none;
}

.spec-label {
    font-weight: 500;
    color: #6b7280;
}

.spec-value {
    font-weight: 500;
    color: #1f2937;
}

/* Actions */
.product-actions {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.action-form {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.quantity-selector {
    display: flex;
    align-items: center;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
    background: white;
}

.quantity-btn {
    background: none;
    border: none;
    padding: 0.75rem 1rem;
    cursor: pointer;
    font-weight: 600;
    color: #6b7280;
    transition: all 0.3s ease;
}

.quantity-btn:hover {
    background: #f3f4f6;
    color: #374151;
}

.quantity-input {
    width: 60px;
    border: none;
    text-align: center;
    font-weight: 600;
    padding: 0.75rem 0;
    background: white;
}

.quantity-input:focus {
    outline: none;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

/* Features */
.product-features {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    padding: 1.5rem;
    background: #f0f9ff;
    border-radius: 8px;
    border: 1px solid #e0f2fe;
}

@media (min-width: 640px) {
    .product-features {
        grid-template-columns: repeat(3, 1fr);
    }
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #0369a1;
}

.feature-item svg {
    flex-shrink: 0;
}

/* Description Tabs */
.product-description {
    border-top: 1px solid #e5e7eb;
    padding-top: 2rem;
}

.description-tabs {
    display: flex;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 2rem;
}

.tab-btn {
    background: none;
    border: none;
    padding: 1rem 1.5rem;
    font-weight: 500;
    color: #6b7280;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

.tab-btn.active {
    color: #6366f1;
    border-bottom-color: #6366f1;
}

.tab-btn:hover {
    color: #374151;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

.tab-pane h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #1f2937;
}

.tab-pane h4 {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 1.5rem 0 0.75rem 0;
    color: #374151;
}

.description-features ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.description-features li {
    padding: 0.5rem 0;
    position: relative;
    padding-left: 1.5rem;
}

.description-features li:before {
    content: '✓';
    position: absolute;
    left: 0;
    color: #10b981;
    font-weight: 600;
}

/* Specs Detail */
.specs-detail {
    display: flex;
    flex-direction: column;
    gap: 0;
}

.spec-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid #e5e7eb;
}

.spec-row:last-child {
    border-bottom: none;
}

.spec-name {
    font-weight: 500;
    color: #6b7280;
}

.spec-value {
    font-weight: 500;
    color: #1f2937;
}

/* Reviews */
.rating-overview {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f9fafb;
    border-radius: 8px;
}

.rating-average {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.average-score {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
}

.reviews-count {
    font-size: 0.875rem;
    color: #6b7280;
}

.reviews-placeholder {
    text-align: center;
    padding: 3rem 2rem;
    color: #6b7280;
    background: #f9fafb;
    border-radius: 8px;
    border: 2px dashed #e5e7eb;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
    border: none;
    text-decoration: none;
    font-size: 0.875rem;
    white-space: nowrap;
}

.btn--primary {
    background: #6366f1;
    color: white;
}

.btn--primary:hover {
    background: #4f46e5;
    transform: translateY(-1px);
}

.btn--outline {
    background: transparent;
    color: #6366f1;
    border: 2px solid #6366f1;
}

.btn--outline:hover {
    background: #6366f1;
    color: white;
}

.btn--disabled {
    background: #9ca3af;
    color: white;
    cursor: not-allowed;
}

.btn--disabled:hover {
    background: #9ca3af;
    transform: none;
}

.btn--large {
    padding: 1rem 2rem;
    font-size: 1rem;
}

.btn--full {
    width: 100%;
}

.btn--icon {
    padding: 0.75rem;
}

/* Responsive */
@media (max-width: 768px) {
    .product-layout {
        gap: 2rem;
    }
    
    .action-form {
        flex-direction: column;
        align-items: stretch;
    }
    
    .quantity-selector {
        justify-content: center;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .description-tabs {
        flex-direction: column;
    }
    
    .tab-btn {
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .tab-btn.active {
        border-bottom: 2px solid #6366f1;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            // Update active tab button
            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Show active tab pane
            tabPanes.forEach(pane => pane.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Quantity selector
    const quantityInput = document.querySelector('.quantity-input');
    const quantityBtns = document.querySelectorAll('.quantity-btn');
    
    quantityBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const action = this.dataset.action;
            let quantity = parseInt(quantityInput.value);
            const max = parseInt(quantityInput.max);
            const min = parseInt(quantityInput.min);
            
            if (action === 'increase' && quantity < max) {
                quantityInput.value = quantity + 1;
            } else if (action === 'decrease' && quantity > min) {
                quantityInput.value = quantity - 1;
            }
        });
    });
    
    // Image gallery (for future multiple images)
    const thumbs = document.querySelectorAll('.thumb');
    const mainImage = document.getElementById('mainImage');
    
    thumbs.forEach(thumb => {
        thumb.addEventListener('click', function() {
            const imageUrl = this.dataset.image;
            
            // Update active thumb
            thumbs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Update main image
            if (mainImage && imageUrl) {
                mainImage.src = imageUrl;
            }
        });
    });
    
    // Add to cart form submission
    const addToCartForm = document.querySelector('.action-form');
    if (addToCartForm) {
        addToCartForm.addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="animate-spin"><path d="M10 3a7 7 0 100 14 7 7 0 000-14zM2 10a8 8 0 1116 0 8 8 0 01-16 0z" opacity="0.2"/><path d="M10 3a7 7 0 017 7h-2a5 5 0 00-5-5V3z"><animateTransform attributeName="transform" type="rotate" from="0 10 10" to="360 10 10" dur="1s" repeatCount="indefinite"/></path></svg> Добавляем...';
                submitBtn.disabled = true;
            }
        });
    }
});

// Simple spinner animation
const style = document.createElement('style');
style.textContent = `
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    .animate-spin {
        animation: spin 1s linear infinite;
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}